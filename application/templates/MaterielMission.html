<!DOCTYPE html>
<html>

<head>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Lien vers Bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
            integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
            integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.6.0/mdb.min.js"></script>
        <!--lien pour les icones-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
        <!-- notre  fichier css -->
        <link rel="stylesheet" type="text/css" href="/static/style.css">
        <title>  Seismos || Consulter la liste des membres de l'équipe</title>
    </head>

<body class="consult">

    {% include 'header.html' %}

    <section class="d-flex align-items-center justify-content-center position-relative ">
        <!--<div class="overlay position-absolute w-100 h-100"></div>-->
        <div class="container position-relative">
            <div class="row justify-content-center">
                <div class="col-md-8 text-center">
                    <h2 class="text-black text-uppercase mb-4  welcom " style="color: #f03535;"> Liste du matériel de la mission : {{idmission}}.</h2>
                    <p class="lead  mb-5" style="color: #92644B;"><b></b></p>
                </div>
            </div>
        </div>
    </section>

    <div class="container mt-4">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID équipement</th>
                    <th>Nom équipement</th>
                    <th>Date de début</th>
                    <th>Date de fin</th>
                </tr>
            </thead>
            <tbody>

                {% for materiel in list_materiel %}

                <tr>
                    <td>{{ materiel['id_eq'] }}</td>
                    <td>{{ materiel['nom'] }}</td>
                    <td>{{ materiel['date_debut'] }}</td>
                    <td>{{ materiel['date_fin'] }}</td>
                </tr>
                {% endfor %}

            </tbody>
        </table>
        <div class="d-flex justify-content-center p-3">
            <input id="boutonAfficher" class="submit btn btn-outline-light btn-lg px-5" value="Ajouter" readonly>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <h5 class="mb-4">Ajouter un nouvel équipement à la mission:</h5>
            <form  action="/Affecterequipement" method="POST" id="formulaireEnregistrement"   class="justify-content-center align-items-center" >
               
                <div style="width: 360px;">
                    <label for="id"><strong>ID :</strong></label>
                    <select id="idSelect" class="form-select" aria-label=".form-select-sm example"  name="id">
                        <option></option>
                        {% for id in listes_id %}
                        <option value="{{ id['_id'] }}">{{id['_id'] }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="nom"><strong>Nom équipement :</strong> </label>
                    <input type="text" class="form-control" id="nom" name="nom" autocomplete="off">
                </div>
                <div>
                    <label for="date_debut"><strong>Date de début :</strong></label>
                    <input type="date" class="form-control" id="date_debut" name="date_debut" autocomplete="off">
                </div>
                <div>
                    <label for="date_fin"><strong>Date de fin :</strong></label>
                    <input type="date" class="form-control" id="date_fin" name="date_fin" autocomplete="off">
                </div>
                <div>
                    <input type="text" id="id_affect" name="id_affect">
                    <input type="hidden" id="idmission" name="idmission" value="{{ idmission }}">
                </div>
                <div class="d-flex justify-content-center">
                    <input type="submit" class="btn-info mx-2" name="Enregistrer" value="Enregistrer" style="margin-left: 5%; border-radius: 1rem;">
                    <input id="boutonFermer" type="button" class="btn-info" value="fermer" style=" border-radius: 1rem;"> 
                </div>

            </form>


        </div>
        
    </div>

    <div class="mt-5 mb-5">
        <div class="col-lg-10 text-center text-lg-start">
            
        </div>
    </div>

    <script>
        // Ajouter un gestionnaire d'événement pour le bouton
        document.getElementById('boutonAfficher').addEventListener('click', function () {
            // Afficher la fenêtre modale en modifiant le style CSS
            document.getElementById('modal').style.display = 'block';
        });

        document.getElementById('idSelect').addEventListener('change', function () {
            var id = this.value;
            fetch('/get_equipement?id=' + id)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('nom').value = data.nom || '';
                    document.getElementById('date_debut').value = data.date_debut || '';
                    document.getElementById('date_fin').value = data.date_fin || '';
                    document.getElementById('id_affect').value = data.id_affect || '';
                })
                .catch(error => console.error(error));
    });



    // Ajouter un gestionnaire d'événement pour le formulaire
    document.getElementById('formulaireEnregistrement').addEventListener('submit', function (event) {
        event.preventDefault(); // Empêcher la soumission du formulaire
    
        // Code pour traiter les données du formulaire
        var id = document.getElementById('idSelect').value;
        var id_aff = document.getElementById('id_affect').value;
        var nom = document.getElementById('nom').value;
        var date_deb = document.getElementById('date_debut').value;
        var date_fin = document.getElementById('date_fin').value;
        var idmission = document.getElementById('idmission').value;
    
        // Vérifier si tous les champs sont vides
        if (id === '' && nom === ''  && date_deb === '' && date_fin === '') {
            alert('Veuillez remplir tous les champs avant de soumettre le formulaire.');
            return; // Sortir de la fonction pour empêcher l'enregistrement
        }
        
    
        // Créer un objet FormData pour envoyer les données du formulaire
        var formData = new FormData();
        formData.append('id', id);
        formData.append('id_aff', id_aff);
        formData.append('nom', nom);
        formData.append('date_deb', date_deb);
        formData.append('date_fin', date_fin);
        formData.append('idmission', idmission);
    
        // Effectuer une requête POST pour envoyer les données du formulaire à l'URL "/AffecterTache"
        fetch('/Affecterequipement', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(data => {
            // Fermer la fenêtre modale en modifiant le style CSS
            document.getElementById('modal').style.display = 'none';
            location.reload();
        })
        .catch(error => console.error(error));
    });

    document.getElementById('boutonFermer').addEventListener('click', function() {
        // Réinitialiser les champs vides
        document.getElementById('idSelect').selectedIndex = 0; // Réinitialiser le select à la première option
        document.getElementById('nom').value = '';
        document.getElementById('date_debut').value = '';
        document.getElementById('date_fin').value = '';
        document.getElementById('id_affect').value = '';
        // Fermer la fenêtre modale en modifiant le style CSS
        document.getElementById('modal').style.display = 'none';
    });
    
    


    </script>
    


    <footer class=" footer-custom ">
        <div class="container">
            <div class="row ">
                <div class="col-lg-10 text-center text-lg-start">
                    © PFE année universitaire 2022/2023
                </div>
            </div>
        </div>
    </footer>
    </div>

</body>

</html>
    